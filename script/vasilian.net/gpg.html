<!DOCTYPE html>
<html lang="en">
<head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NNSN5N589Z"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NNSN5N589Z');
</script>

<title>GPG and RPM</title>
<link href="main.css" rel="stylesheet" type="text/css" media="all">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
</head>
<body>
<a href="index.html">Back to main index</a>
<h1>GPG & RPM</h1>


<p>
There are 3 ways to sign a RPM package:<br>
&ensp;&bull;  when it is built<br>
&ensp;&bull;  re-sign a package that's already been signed<br>
&ensp;&bull;  sign an existing RPM that has no signature<br>
</p>

1. Generate a new gpg secret key - see
<a href="https://docs.github.com/en/authentication/managing-commit-signature-verification/generating-a-new-gpg-key" target="_blank">tutorial</a>:


<pre>
$ gpg --full-generate-key

Select (1) RSA and RSA (default)
Select keysize (3072) (default)
Select how long the key should be valid.
    0 = key does not expire

Real name: Mihai Vasilian
Email address: grayasm@gmail.com
Comment: RPM Signing Key
You selected this USER-ID:
    "Mihai Vasilian (RPM Signing Key) &lt;grayasm@gmail.com&gt;"

Type a secure passphrase.
Done.
</pre>   

2. List all secret keys:

<pre>
$ gpg --list-secret-keys

/home/mihai/.gnupg/pubring.kbx
------------------------------
sec   rsa3072 2022-10-08 [SC]
      6EE6BDF08BF51743ABE189E89C03756E10264874
uid           [ultimate] Mihai Vasilian (RPM Signing Key) <grayasm@gmail.com>
ssb   rsa3072 2022-10-08 [E]
</pre>

3. Print the GPG key ID, in ASCII armor format:
<pre>
$ gpg --armor --export 6EE6BDF08BF51743ABE189E89C03756E10264874
</pre>

<p>
Copy your GPG key, beginning with -----BEGIN PGP PUBLIC KEY BLOCK-----<br>
and ending with -----END PGP PUBLIC KEY BLOCK-----<br>
and save it as RPM-GPG-KEY-vasilian<br>
</p>


4. To remove a secret key use:
<pre>
$ gpg --delete-secret-key 6EE6BDF08BF51743ABE189E89C03756E10264874
</pre>

5. Install old GPG keys on a new machine:
<p>
If you already have the keys in the email then saving them in ~/.gnupg is enough<br>
to make gnupg import the keys automatically.
</p>

<pre>
mkdir ~/.gnupg
cd ~/.gnupg
mv ~/Downloads/pubring.gpg .
mv ~/Downloads/secring.gpg .
chcon -t gpg_secret_t -v pubring.gpg
chcon -t gpg_secret_t -v secring.gpg
cd ~
gpg --list-keys
gpg --list-secret-keys
</pre>

6. Get GPG keys from an old computer: 
<p>
If you forgot to save the keys but still have the computer where the keys were<br>
generated then export them as indicated 
<a href="https://unix.stackexchange.com/questions/481939/how-to-export-a-gpg-private-key-and-public-key-to-a-file" target="_blank">here</a>
 with:
</p>

<pre>
gpg --output pubring.gpg --armor --export grayasm@gmail.com
gpg --output secring.gpg --armor --export-secret-key grayasm@gmail.com
</pre>


7. Check if the gpg-agent is running:

<pre>
$ gpg-agent --daemon
gpg-agent: a gpg-agent is already running - not starting a new one
</pre>


8. Set the secret key for rpmbuild
<p>
edit $HOME/.rpmmacros and add 3 lines:
</p>    
<pre>
%_signature    gpg
%_gpg_path     /home/mihai/.gnupg
%_gpg_name     Mihai Vasilian (RPM Signing Key) &lt;grayasm@gmail.com&gt;
</pre>

9. Build and sign the rpm package using:
<pre>
$ rpmbuild -v --bb --clean SPECS/sign3.spec
$ rpmsign --addsign ./RPMS/x86_64/sign3-0.1-1.el7.x86_64.rpm
</pre>



<a href="index.html">Back to main index</a>
</body>
</html>
